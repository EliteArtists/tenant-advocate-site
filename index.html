<!DOCTYPE html>
<html lang="en">
<head>
Â  Â  <meta charset="UTF-8">
Â  Â  <meta name="viewport" content="width=device-width, initial-scale=1">
Â  Â  <title>Tenant Advocate</title>
Â  Â  <link rel="stylesheet" href="style.css">
</head>
<body>
Â  Â  <div class="hero-container">
Â  Â  <img src="assets/TA HERO IMAGE.png" alt="Tenant Advocate App Coming Soon" class="hero-image">
</div>
Â  Â Â 
Â  Â  <header>
Â  Â  <button id="add-agent-button" style="background: none; border: none; color: #333; font-weight: bold; cursor: pointer;">Add Agent</button>
Â  Â  <img src="assets/Color logo - no background.svg" alt="Tenant Advocate Logo" class="header-logo">
Â  Â  <div class="burger-menu-container">
Â  Â  Â  Â  <div class="burger-icon" id="burger-icon">
Â  Â  Â  Â  Â  Â  <div class="bar1"></div>
Â  Â  Â  Â  Â  Â  <div class="bar2"></div>
Â  Â  Â  Â  Â  Â  <div class="bar3"></div>
Â  Â  Â  Â  </div>
Â  Â  Â  Â  <div class="dropdown-menu" id="dropdown-menu">
Â  Â  Â  Â  Â  Â  <a href="#" class="city-filter" data-city="all">All Cities</a>
Â  Â  Â  Â  Â  Â  <a href="#" class="city-filter" data-city="London">London</a>
Â  Â  Â  Â  Â  Â  <a href="#" class="city-filter" data-city="Manchester">Manchester</a>
Â  Â  Â  Â  Â  Â  <a href="#" class="city-filter" data-city="Birmingham">Birmingham</a>
Â  Â  Â  Â  Â  Â  <a href="#" class="city-filter" data-city="Glasgow">Glasgow</a>
Â  Â  Â  Â  Â  Â  <a href="#" class="city-filter" data-city="Bristol">Bristol</a>
Â  Â  Â  Â  Â  Â  </div>
Â  Â  </div>
Â  Â  </header>

<div class="marquee-container">
Â  Â  <p class="marquee-text">
Â  Â  Â  Â  TENANT ADVOCATE: YOUR GUIDE TO THE BEST AND WORST LETTING AGENTS IN THE UK. Â Â Â Â Â Â 
Â  Â  Â  Â  OUR RISK RATINGS ARE CALCULATED BY AN ALGORITHM THAT COMBINES GOOGLE AND TRUSTPILOT REVIEWS TO PRODUCE A LOW, MEDIUM, OR HIGH RISK RATING. Â Â Â Â Â Â 
Â  Â  Â  Â  PLEASE BEAR WITH US AS WE CONTINUE TO IMPROVE THE WEBSITE'S FEATURES AND DATA.
Â  Â  </p>
</div>
<form id="add-agent-form">
</form>

Â  Â  <div class="search-container">
Â  Â  Â  Â  <input type="text" id="search" placeholder="Search agentsâ€¦">
Â  Â  </div>

Â  Â  <main>
Â  Â  Â  Â  <div class="grid" id="agents-grid">
Â  Â  Â  Â  Â  Â  </div>
Â  Â  </main>

Â  Â  <div id="agent-detail-modal" class="modal">
Â  Â  Â  Â  <div class="modal-content">
Â  Â  Â  Â  Â  Â  <span class="close-button">Ã—</span>
Â  Â  Â  Â  Â  Â  <h2 id="detail-agent-name"></h2>
Â  Â  Â  Â  Â  Â  <p id="detail-full-address"></p>
Â  Â  Â  Â  Â  Â  <p>Google Rating: <span id="detail-google-rating"></span> â­ (<span id="detail-google-reviews"></span> reviews)</p>
Â  Â  Â  Â  Â  Â  <p>Trustpilot Rating: <span id="detail-trustpilot-rating">N/A</span> â­</p>
Â  Â  Â  Â  Â  Â  <div id="detail-reviews-section" style="margin-top: 20px;">
Â  Â  Â  Â  Â  Â  Â  Â  <h3>Reviews</h3>
Â  Â  Â  Â  Â  Â  Â  Â  <p>Actual Google review text cannot be displayed directly due to API terms.</p>
Â  Â  Â  Â  Â  Â  Â  Â  <p id="detail-google-map-link"></p>
Â  Â  Â  Â  Â  Â  Â  Â  <p>Trustpilot reviews not yet integrated.</p>
Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  </div>
Â  Â  </div>

Â  Â  Â  Â  <div id="add-agent-modal" class="modal">
Â  Â  Â  Â  <div class="modal-content">
Â  Â  Â  Â  Â  Â  <span class="close-button add-agent-close-button">Ã—</span>
Â  Â  Â  Â  Â  Â  <h2 style="margin-bottom: 1rem;">Add a New Agent</h2>
Â  Â  Â  Â  Â  Â  <form id="add-agent-form">
Â  Â  Â  Â  Â  Â  Â  Â  <input name="name" id="agent-name-input" placeholder="Name" required>
Â  Â  Â  Â  Â  Â  Â  Â  <input name="location" placeholder="Location" required>
Â  Â  Â  Â  Â  Â  Â  Â  <input name="full_address" placeholder="Full address" required>
Â  Â  Â  Â  Â  Â  Â  Â  <input type="hidden" name="slug" id="slug-input">
Â  Â  Â  Â  Â  Â  Â  Â  <button type="submit">Add Agent</button>
Â  Â  Â  Â  Â  Â  </form>
Â  Â  Â  Â  </div>
Â  Â  </div>
Â  Â  Â  Â  <script>
Â  Â  Â  Â  // Utility function to filter cards by slug
Â  Â  Â  Â  function filterBySlug(slug) {
Â  Â  Â  Â  Â  Â  document.querySelectorAll('.card').forEach(card => {
Â  Â  Â  Â  Â  Â  Â  Â  card.style.display = (card.dataset.slug === slug) ? '' : 'none';
Â  Â  Â  Â  Â  Â  });
Â  Â  Â  Â  }

Â  Â  Â  Â  // Function to create and append an agent card
Â  Â  Â  Â  function createAgentCard(agent) {
Â  Â  Â  Â  Â  Â  // Parse ratings (fall back to 0 if missing/null)
Â  Â  Â  Â  Â  Â  const slugÂ  Â  Â  Â  Â  Â  = agent.slug;
Â  Â  Â  Â  Â  Â  const Maps_API_KEY = 'AIzaSyDiqsCUUnW3TcxfwBwFsOQbxThe2OxcnvE'; // <<< YOUR API KEY HERE!
Â  Â  Â  Â  Â  Â  let imageUrl = agent.image_url || 'https://via.placeholder.com/300x200?text=No+Image';

Â  Â  Â  Â  Â  Â  // If it's a Google Place Photo URL and we have an API key, append the key
Â  Â  Â  Â  Â  Â  if (imageUrl.startsWith('https://maps.googleapis.com/maps/api/place/photo') && Maps_API_KEY) {
Â  Â  Â  Â  Â  Â  Â  Â  imageUrl = `${imageUrl}&key=${Maps_API_KEY}`;
Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â  const googleScoreÂ  Â  Â = parseFloat(agent.google_rating) || 0;
Â  Â  Â  Â  Â  Â  const googleReviewCount = parseInt(agent.google_review_count) || 0; // Ensure it's an integer
Â  Â  Â  Â  Â  Â  const trustpilotScore = parseFloat(agent.trustpilot_rating) || 0; // This will likely be 0 or null

Â  Â  Â  Â  Â  Â  // --- UPDATED RISK LEVEL LOGIC ---
Â  Â  Â  Â  Â  Â  let riskLevel;
Â  Â  Â  Â  Â  Â  if (googleScore === 0) {
Â  Â  Â  Â  Â  Â  Â  Â  riskLevel = 'Unknown';
Â  Â  Â  Â  Â  Â  } else if (googleScore >= 4.0) {
Â  Â  Â  Â  Â  Â  Â  Â  riskLevel = 'Low';
Â  Â  Â  Â  Â  Â  } else if (googleScore >= 3.0) {
Â  Â  Â  Â  Â  Â  Â  Â  riskLevel = 'Medium';
Â  Â  Â  Â  Â  Â  } else {
Â  Â  Â  Â  Â  Â  Â  Â  riskLevel = 'High';
Â  Â  Â  Â  Â  Â  }

Â  Â  Â  Â  Â  Â  // build card
Â  Â  Â  Â  Â  Â  const card = document.createElement('div');
Â  Â  Â  Â  Â  Â  card.className = 'card';
Â  Â  Â  Â  Â  Â  card.setAttribute('data-slug', slug);
Â  Â  Â  Â  Â  Â  card.innerHTML = `
Â  Â  Â  Â  Â  Â  Â  Â  <img src="${imageUrl}" alt="${agent.name}">
Â  Â  Â  Â  Â  Â  Â  Â  <h2>${agent.name}</h2>
Â  Â  Â  Â  Â  Â  Â  Â  <p>${agent.full_address || agent.location || 'Address N/A'}</p>
Â  Â  Â  Â  Â  Â  Â  Â  <p>Reviews: ${googleReviewCount}</p>
Â  Â  Â  Â  Â  Â  Â  Â  <p>Google: ${googleScore.toFixed(1)} â­</p>
Â  Â  Â  Â  Â  Â  Â  Â  <p>Trustpilot: ${trustpilotScore.toFixed(1)} â­</p>
Â  Â  Â  Â  Â  Â  Â  Â  <span class="badge ${riskLevel}">${riskLevel}</span>
Â  Â  Â  Â  Â  Â  `;

Â  Â  Â  Â  Â  Â  // Attach click listener to show detail modal
Â  Â  Â  Â  Â  Â  card.addEventListener('click', () => {
Â  Â  Â  Â  Â  Â  Â  Â  showAgentDetail(agent); // Pass the entire agent object to the detail function
Â  Â  Â  Â  Â  Â  });

Â  Â  Â  Â  Â  Â  return card;
Â  Â  Â  Â  }

Â  Â  Â  Â  // Function to show agent details in a modal
Â  Â  Â  Â  const agentDetailModal = document.getElementById('agent-detail-modal');
Â  Â  Â  Â  const closeButton = document.querySelector('.close-button');

Â  Â  Â  Â  closeButton.addEventListener('click', () => {
Â  Â  Â  Â  Â  Â  agentDetailModal.style.display = 'none';
Â  Â  Â  Â  });

Â  Â  Â  Â  window.addEventListener('click', (event) => {
Â  Â  Â  Â  Â  Â  if (event.target == agentDetailModal) {
Â  Â  Â  Â  Â  Â  Â  Â  agentDetailModal.style.display = 'none';
Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  });

Â  Â  Â  Â  // BURGER MENU JAVASCRIPT STARTS HERE
Â  Â  Â  Â  const burgerIcon = document.getElementById('burger-icon');
Â  Â  Â  Â  const dropdownMenu = document.getElementById('dropdown-menu');

Â  Â  Â  Â  burgerIcon.addEventListener('click', () => {
Â  Â  Â  Â  Â  Â  dropdownMenu.classList.toggle('show');
Â  Â  Â  Â  });

Â  Â  Â  Â  // Close dropdown if clicked outside
Â  Â  Â  Â  window.addEventListener('click', (event) => {
Â  Â  Â  Â  Â  Â  if (!event.target.closest('.burger-menu-container') && dropdownMenu.classList.contains('show')) {
Â  Â  Â  Â  Â  Â  Â  Â  dropdownMenu.classList.remove('show');
Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  });

Â  Â  Â  Â  // City Filter Logic
Â  Â  Â  Â  document.querySelectorAll('.city-filter').forEach(link => {
Â  Â  Â  Â  Â  Â  link.addEventListener('click', (event) => {
Â  Â  Â  Â  Â  Â  Â  Â  event.preventDefault(); // Prevent default link behavior (page jump)
Â  Â  Â  Â  Â  Â  Â  Â  const city = event.target.dataset.city;
Â  Â  Â  Â  Â  Â  Â  Â  const cards = document.querySelectorAll('.card');

Â  Â  Â  Â  Â  Â  Â  Â  cards.forEach(card => {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  const fullAddress = card.querySelector('p:nth-of-type(1)').textContent; // Get the address from the card
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  if (city === 'all' || fullAddress.toLowerCase().includes(city.toLowerCase())) {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  card.style.display = ''; // Show
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  } else {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  card.style.display = 'none'; // Hide
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â  Â  Â  });
Â  Â  Â  Â  Â  Â  Â  Â  dropdownMenu.classList.remove('show'); // Hide menu after selection
Â  Â  Â  Â  Â  Â  });
Â  Â  Â  Â  });
Â  Â  Â  Â  // BURGER MENU JAVASCRIPT ENDS HERE

Â  Â  Â  Â  function showAgentDetail(agent) {
Â  Â  Â  Â  Â  Â  document.getElementById('detail-agent-name').textContent = agent.name;
Â  Â  Â  Â  Â  Â  document.getElementById('detail-full-address').textContent = agent.full_address || agent.location || 'Address not available';
Â  Â  Â  Â  Â  Â  document.getElementById('detail-google-rating').textContent = (parseFloat(agent.google_rating) || 0).toFixed(1);
Â  Â  Â  Â  Â  Â  document.getElementById('detail-google-reviews').textContent = agent.google_review_count || 0;
Â  Â  Â  Â  Â  Â  // Ensure Trustpilot rating displays '0.0' or 'N/A' if null/0
Â  Â  Â  Â  Â  Â  document.getElementById('detail-trustpilot-rating').textContent = (parseFloat(agent.trustpilot_rating) || 0).toFixed(1);

Â  Â  Â  Â  Â  Â  // Get the reviews section element
Â  Â  Â  Â  Â  Â  const detailReviewsSection = document.getElementById('detail-reviews-section');
Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  // Clear previous dynamic content
Â  Â  Â  Â  Â  Â  detailReviewsSection.innerHTML = `
Â  Â  Â  Â  Â  Â  Â  Â  <h3>Reviews</h3>
Â  Â  Â  Â  Â  Â  Â  Â  <p>Actual Google review text cannot be displayed directly due to API terms.</p>
Â  Â  Â  Â  Â  Â  Â  Â  <p id="detail-google-map-link"></p>
Â  Â  Â  Â  Â  Â  Â  Â  <p>Trustpilot reviews not yet integrated.</p>
Â  Â  Â  Â  Â  Â  `; // Re-add standard text

Â  Â  Â  Â  Â  Â  // Add website link if available
Â  Â  Â  Â  Â  Â  if (agent.website_url) {
Â  Â  Â  Â  Â  Â  Â  Â  const websiteLink = document.createElement('p');
Â  Â  Â  Â  Â  Â  Â  Â  websiteLink.innerHTML = `Website: <a href="${agent.website_url}" target="_blank">${agent.website_url}</a>`;
Â  Â  Â  Â  Â  Â  Â  Â  detailReviewsSection.insertBefore(websiteLink, detailReviewsSection.firstChild); // Add before existing review text
Â  Â  Â  Â  Â  Â  }

Â  Â  Â  Â  Â  Â  // Generate Google Maps link
Â  Â  Â  Â  Â  Â  const googleMapsLinkElement = document.getElementById('detail-google-map-link');
Â  Â  Â  Â  Â  Â  let mapsLinkHtml = ''; // Initialize as empty string

Â  Â  Â  Â  Â  Â  // Construct the query string from agent data
Â  Â  Â  Â  Â  Â  const agentQueryParts = [];
Â  Â  Â  Â  Â  Â  if (agent.name) {
Â  Â  Â  Â  Â  Â  Â  Â  agentQueryParts.push(agent.name);
Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â  if (agent.full_address) {
Â  Â  Â  Â  Â  Â  Â  Â  agentQueryParts.push(agent.full_address);
Â  Â  Â  Â  Â  Â  } else if (agent.location) {
Â  Â  Â  Â  Â  Â  Â  Â  agentQueryParts.push(agent.location);
Â  Â  Â  Â  Â  Â  }

Â  Â  Â  Â  Â  Â  if (agentQueryParts.length > 0) {
Â  Â  Â  Â  Â  Â  Â  Â  const query = encodeURIComponent(agentQueryParts.join(' '));
Â  Â  Â  Â  Â  Â  Â  Â  // Correct Google Maps search URL with API parameter
Â  Â  Â  Â  Â  Â  Â  Â  const Maps_API_KEY = 'AIzaSyDiqsCUUnW3TcxfwBwFsOQbxThe2OxcnvE'; // Define API key for this scope
Â  Â  Â  Â  Â  Â  Â  Â  const mapsUrl = `http://maps.google.com/?api=1&query=${query}&key=${Maps_API_KEY}`;
Â  Â  Â  Â  Â  Â  Â  Â  mapsLinkHtml = `Read Google reviews on <a href="${mapsUrl}" target="_blank">Google Maps</a>`;
Â  Â  Â  Â  Â  Â  }

Â  Â  Â  Â  Â  Â  googleMapsLinkElement.innerHTML = mapsLinkHtml;

Â  Â  Â  Â  Â  Â  agentDetailModal.style.display = 'block';
Â  Â  Â  Â  }

Â  Â  Â  Â  // Fetch agent data and render cards
Â  Â  Â  Â  fetch('https://tenant-advocate-api.vercel.app/api/agents')
Â  Â  Â  Â  Â  Â  .then(res => res.json())
Â  Â  Â  Â  Â  Â  .then(data => {
Â  Â  Â  Â  Â  Â  Â  Â  // --- START OF NEW LOGS ---
Â  Â  Â  Â  Â  Â  Â  Â  console.log('ğŸš€ raw agent payload sample:', data[0]); // Log the first agent object
Â  Â  Â  Â  Â  Â  Â  Â  if (data.length > 1) { // Log a second one if available for comparison
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  console.log('ğŸš€ raw agent payload sample 2:', data[1]);
Â  Â  Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â  Â  Â  // Also, let's confirm your data structure for what is in the "agent" object passed to createAgentCard
Â  Â  Â  Â  Â  Â  Â  Â  console.log('ğŸš€ Agent object passed to createAgentCard (first agent):', data[0]);
Â  Â  Â  Â  Â  Â  Â  Â  // --- END OF NEW LOGS ---

Â  Â  Â  Â  Â  Â  Â  Â  const grid = document.getElementById('agents-grid');
Â  Â  Â  Â  Â  Â  Â  Â  data.forEach(agent => {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  const card = createAgentCard(agent);
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  grid.appendChild(card);
Â  Â  Â  Â  Â  Â  Â  Â  });

Â  Â  Â  Â  Â  Â  Â  Â  // After all initial cards are rendered, check for hash and apply filter
Â  Â  Â  Â  Â  Â  Â  Â  if (location.hash) {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  filterBySlug(location.hash.slice(1));
Â  Â  Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â  })
Â  Â  Â  Â  Â  Â  .catch(error => {
Â  Â  Â  Â  Â  Â  Â  Â  console.error('Error fetching agents:', error);
Â  Â  Â  Â  Â  Â  Â  Â  document.getElementById('agents-grid').innerHTML = '<p>Failed to load agent data. Please try again later.</p>';
Â  Â  Â  Â  Â  Â  });

Â  Â  Â  Â  // Basic search filter
Â  Â  Â  Â  document.getElementById('search').addEventListener('input', e => {
Â  Â  Â  Â  Â  Â  const term = e.target.value.toLowerCase();
Â  Â  Â  Â  Â  Â  document.querySelectorAll('.card').forEach(card => {
Â  Â  Â  Â  Â  Â  Â  Â  const name = card.querySelector('h2').textContent.toLowerCase();
Â  Â  Â  Â  Â  Â  Â  Â  // This will now include full_address for search
Â  Â  Â  Â  Â  Â  Â  Â  const loc = card.querySelector('p').textContent.toLowerCase();
Â  Â  Â  Â  Â  Â  Â  Â  card.style.display = (name.includes(term) || loc.includes(term)) ? '' : 'none';
Â  Â  Â  Â  Â  Â  });
Â  Â  Â  Â  });

Â  Â  Â  Â  // Function to automatically generate a URL-safe slug
function generateSlug(text) {
Â  Â  return text
Â  Â  Â  Â  .toString()
Â  Â  Â  Â  .normalize('NFD')
Â  Â  Â  Â  .replace(/[\u0300-\u036f]/g, '')
Â  Â  Â  Â  .toLowerCase()
Â  Â  Â  Â  .trim()
Â  Â  Â  Â  .replace(/\s+/g, '-')
Â  Â  Â  Â  .replace(/[^\w-]+/g, '')
Â  Â  Â  Â  .replace(/--+/g, '-');
}

// add agent form handler
const form = document.querySelector('#add-agent-form');
const grid = document.querySelector('#agents-grid');
const nameInput = document.getElementById('agent-name-input');
const slugInput = document.getElementById('slug-input');

// Listen for input on the agent name field to automatically generate the slug
nameInput.addEventListener('input', (event) => {
Â  Â  const name = event.target.value;
Â  Â  const slug = generateSlug(name);
Â  Â  slugInput.value = slug;
});

form.addEventListener('submit', async evt => {
Â  Â  evt.preventDefault();

Â  Â  const payload = {
Â  Â  Â  Â  name: nameInput.value,
Â  Â  Â  Â  location: form.location.value,
Â  Â  Â  Â  full_address: form.full_address.value,
Â  Â  Â  Â  slug: slugInput.value, // Use the new hidden slug input field
Â  Â  };

Â  Â  const res = await fetch('https://tenant-advocate-api.vercel.app/api/agents', {
Â  Â  Â  Â  method: 'POST',
Â  Â  Â  Â  headers: { 'Content-Type': 'application/json' },
Â  Â  Â  Â  body: JSON.stringify(payload),
Â  Â  });

Â  Â  const data = await res.json();
Â  Â  if (!res.ok) {
Â  Â  Â  Â  return alert('Insert failed: ' + (data.error || res.statusText));
Â  Â  }

Â  Â  // Assuming your POST API returns the full agent object with new data
Â  Â  const newCard = createAgentCard(data);
Â  Â  grid.appendChild(newCard);

Â  Â  form.reset();
});
Â  Â  </script>
</body>
</html>
